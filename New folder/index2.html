<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุฎููู - ุงูุชุดู ุนุทุฑู ุงููุซุงูู</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <img src="logo.svg" alt="ููุฎููู" class="brand-logo">
            </div>
            <h1 class="brand-name">ููุฎููู</h1>
            <p class="tagline">ุญุถูุฑ ูุง ููุณู</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
            <div class="progress-text" id="progressText">1 / 6</div>
        </div>

        <!-- Quiz Form -->
        <div class="quiz-container" id="quizContainer">
            <form id="quizForm" method="POST">
                
                <!-- Step 1: Age -->
                <div class="step" data-step="1">
                    <h2 class="step-title">ูู ุนูุฑูุ</h2>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="age" value="under18">
                            <div class="option-box">ุฃูู ูู 18</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="age" value="20s">
                            <div class="option-box">ุงูุนุดุฑููุงุช</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="age" value="30s">
                            <div class="option-box">ุงูุซูุงุซููุงุช</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="age" value="40s">
                            <div class="option-box">ุงูุฃุฑุจุนููุงุช</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="age" value="50plus">
                            <div class="option-box">50+</div>
                        </label>
                    </div>
                </div>

                <!-- Step 2: Gender -->
                <div class="step" data-step="2" style="display: none;">
                    <h2 class="step-title">ุงุฎุชุฑ ุงููุฆุฉ</h2>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="gender" value="male">
                            <div class="option-box">ุฑุฌุงูู</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="gender" value="female">
                            <div class="option-box">ูุณุงุฆู</div>
                        </label>
                    </div>
                </div>

                <!-- Step 3: Usage -->
                <div class="step" data-step="3" style="display: none;">
                    <h2 class="step-title">ูุชู ุณุชุณุชุฎุฏู ุงูุนุทุฑ ุบุงูุจูุงุ</h2>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="usage" value="daily">
                            <div class="option-box">ูููู</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="usage" value="formal">
                            <div class="option-box">ููุงุณุจุงุช</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="usage" value="night">
                            <div class="option-box">ูุณุงุก</div>
                        </label>
                    </div>
                </div>

                <!-- Step 4: Strength -->
                <div class="step" data-step="4" style="display: none;">
                    <h2 class="step-title">ุชุญุจ ุงูุนุทุฑ ููููุ</h2>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="strength" value="soft">
                            <div class="option-box">ูุงุนู ููุฑูุจ</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="strength" value="balanced">
                            <div class="option-box">ูุชูุงุฒู</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="strength" value="strong">
                            <div class="option-box">ููู ููุงูุช</div>
                        </label>
                    </div>
                </div>

                <!-- Step 5: Style -->
                <div class="step" data-step="5" style="display: none;">
                    <h2 class="step-title">ุฃู ุทุงุจุน ูููุช ุงูุชุจุงูู ุฃูุซุฑุ</h2>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="style" value="classic">
                            <div class="option-box">ููุงุณููู ูุฃููู</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="style" value="modern">
                            <div class="option-box">ุนุตุฑู ููุถูุก</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="style" value="mysterious">
                            <div class="option-box">ุบุงูุถ ูุนููู</div>
                        </label>
                    </div>
                </div>

                <!-- Step 6: Note -->
                <div class="step" data-step="6" style="display: none;">
                    <h2 class="step-title">ุงุฎุชุฑ ุงูููุชุฉ ุงูุฃูุฑุจ ูููุจู</h2>
                    <div class="options">
                        <label class="option-label">
                            <input type="radio" name="note" value="oud">
                            <div class="option-box">ุนูุฏ ูุฎุดุจ</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="note" value="floral">
                            <div class="option-box">ุฒููุฑ ูุงุนูุฉ</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="note" value="sweet">
                            <div class="option-box">ุญูุงูุฉ ุฏุงูุฆุฉ</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="note" value="fresh">
                            <div class="option-box">ุงูุชุนุงุด ูุญูุถูุงุช</div>
                        </label>
                        <label class="option-label">
                            <input type="radio" name="note" value="spicy">
                            <div class="option-box">ุชูุงุจู ูุญูุฏูุฉ</div>
                        </label>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="navigation">
                    <button type="button" class="btn-prev" id="prevBtn" style="display: none;">โ ุงูุณุงุจู</button>
                </div>

            </form>
        </div>

        <!-- Result Container -->
        <div class="result-container" id="resultContainer" style="display: none;">
            <div class="result-card">
                <div class="perfume-result">
                    <div class="perfume-image-container">
                        <img id="plantImage" src="" alt="" class="perfume-image">
                    </div>
                    
                    <h3 id="plantName" class="perfume-name"></h3>
                    
                    <div id="plantDescription" class="perfume-description"></div>
                    
                    <div class="result-actions">
                        <button id="resetButton" class="btn-secondary">
                            ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>ยฉ 2025 ููุฎููู</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        
        // Perfume database
        const perfumes = {
            shakhah: {
                image: 'https://via.placeholder.com/400x300/0a0a0a/7b1b38?text=๐ฉ',
                name: '',
                latinName: '',
                gender: 'none',
                notes: '',
                description: ''
            },
            ouwar: {
                image: 'imgs/awar.jpg',
                name: 'ุฃููุงุฑ',
                latinName: 'ouwar',
                gender: 'male',
                notes: 'ุจุฑุบููุช โ ูููู ูุฑุฏู โ ุนูุฏ โ ุนูุจุฑ ุฃุจูุถ โ ุฌูุฏ โ ูุณู',
                description: 'ุนุทุฑ ููู ูุญุงุฏุ ุฑุงูู ูุฌุฐุงุจุ ูุนูุณ ูุฎุงูุฉ ุนูููุฉ ูุญุถูุฑูุง ูุงุซููุงุ ุจุทุงุจุน ุฌูุฏูโุนูุฏู ุฃููู.'
            },
            alez: {
                image: 'imgs/alaz.jpg',
                name: 'ุงูุนูุฒ',
                latinName: 'alez',
                gender: 'male',
                notes: 'ุจุฑุบููุช โ ูุงููุฏุฑ โ ุฒุนูุฑุงู โ ุนูุฏ ุฎุดุจู โ ุฌูุฏ โ ูุณู โ ุนูุฏ',
                description: 'ุดุฑูู ุฎุดุจู ุฃุฑููุงุชููุ ูููุจ ููุชุฒูุ ูุฌูุน ุจูู ุงูุฑุฌููุฉ ุงูููุงุณูููุฉ ูุงูููุฉ ุงูุดุฑููุฉ.'
            },
            gentle: {
                image: 'imgs/gentle.jpg',
                name: 'ุฌููุชู',
                latinName: 'gentle',
                gender: 'male',
                notes: 'ุชูุช ุงูุนุฑุนุฑ โ ุฌูุฒุฉ ุงูุทูุจ โ ูุฒุจุฑุฉ โ ูุงููููุง โ ูุณู โ ูุฑุงููู โ ุฎุดุจ ุงูุนูุจุฑ',
                description: 'ุฏุงูุฆ ูุญููุ ูุงุนู ููุงุฎุฑุ ุจูุงููููุง ุบููุฉ ูููุณุฉ ูุฎูููุฉ ุฃูููุฉ.'
            },
            arabi: {
                image: 'imgs/azbi.jpg',
                name: 'ุนูุฑูุจู',
                latinName: 'arabi',
                gender: 'male',
                notes: 'ุฒุนูุฑุงู โ ูุฑุฏ ุฃุณูุฏ โ ูุงููููุง โ ุจุงุชุดููู โ ุนูุฏ',
                description: 'ูุฎูุ ุฏุงูุฆ ูุบุงูุถุ ุจุฑูุญ ุดุฑููุฉ ุฃุตููุฉ ูููุณุฉ ุนูุฏ ุนูููุฉ.'
            },
            rajul: {
                image: 'imgs/rajul.jpg',
                name: 'ุฑูุฌูู',
                latinName: 'rajul',
                gender: 'male',
                notes: 'ููู โ ุฌูุฏ โ ุนูุจุฑ โ ุทุญุงูุจ โ ุจุงุชุดููู',
                description: 'ุฌูุฏู ุชุฑุงุจู ูููุ ุฑุฌููู ุตูุฑูุ ูุนูุณ ุงูุซุจุงุช ูุงูููุจุฉ ูุงููุถุฌ.'
            },
            ghasaq: {
                image: 'imgs/ghasaq.jpg', //!
                name: 'ุบูุณูู',
                latinName: 'ghasaq',
                gender: 'male',
                notes: 'ุญูุถูุงุช โ ุชูุงุจู ุฏุงูุฆุฉ โ ุฃูุฑููุฏ ุฃุณูุฏ โ ุจุฎูุฑ โ ุฃุฎุดุงุจ โ ุดููููุง',
                description: 'ุฏุงูุฆุ ูุงุฎุฑ ูุบุงููุ ุจุทุงุจุน ุดุฑูู ุฒูุฑู ูุธูู ูููุณุฉ ุดููููุงุชุฉ ุนูููุฉ.'
            },
            haybah: {
                image: 'imgs/heyba.jpg',
                name: 'ููููุจูุฉ',
                latinName: 'haybah',
                gender: 'male',
                notes: 'ุฃูุงูุงุณ โ ูุฑูููู โ ุจุฑุบููุช โ ุจุงุชุดููู โ ูุงุณููู โ ุฃุฎุดุงุจ โ ุทุญุงูุจ',
                description: 'ููุนุด ูุงุฎุฑุ ููู ุงูุดุฎุตูุฉุ ูุฌูุน ุจูู ุงูุญุฏุงุซุฉ ูุงูููุจุฉ ุงูููุงุณูููุฉ.'
            },
            jamr: {
                image: 'imgs/jamr.jpg',
                name: 'ุฌูููุฑ',
                latinName: 'jamr',
                gender: 'male',
                notes: 'ููู โ ูุฑูุฉ โ ุจุงุชุดููู โ ูุฑุฏ ุชุฑูู โ ุฌูุฏ โ ุนูุฏ ุนูุจุฑู',
                description: 'ุญุงุฑ ูุฏุงูุฆุ ุดุฑูู ุฌูุฏูุ ุฌุฑูุก ููุดุชุนู ูุงูุฌูุฑ.'
            },
            // dukhoon: {
            //     image: 'imgs/dukhoon.jpg', //!
            //     name: 'ุฏูุฎููู',
            //     latinName: 'dukhoon',
            //     gender: 'male',
            //     notes: 'ุชูุช ุจุฑู โ ุตุจุงุฑ โ ูุงุฑุณูุณู โ ุฎุดุจ ุตูุฏู โ ุชุจุบ โ ูุงููููุง โ ุจูุณู',
            //     description: 'ุฏุฎุงูู ูุงุนูุ ุฏุงูุฆ ูุบุงูุถุ ูุชูุงุฒู ุจูู ุงูุญูุงูุฉ ูุงูุนูู ุงูุฎุดุจู.'
            // },
            waqar: {
                image: 'imgs/waqar.jpg',
                name: 'ููููุงุฑ',
                latinName: 'waqar',
                gender: 'male',
                notes: 'ููู โ ูููู โ ุฎุดุจ ุตูุฏู โ ุนูุฏ โ ุจุงุชุดููู โ ุชูููุง โ ุนูุจุฑ โ ูุงููููุง',
                description: 'ูุฎู ููุงุฏุฆุ ุนููู ููุชุฒูุ ูุนูุณ ุงูููุงุฑ ูุงูุฑูู ุงูุนุงูู.'
            },
            ufuq: {
                image: 'imgs/ufuq.jpg',
                name: 'ุฃูููู',
                latinName: 'ufuq',
                gender: 'male',
                notes: 'ููุฏุฑูู โ ูุฑุงููู โ ุนุณู โ ุชูููุง',
                description: 'ุฏุงูุฆ ุญููุ ูุฑูุญ ููุงุนูุ ุจุฅุญุณุงุณ ุนุตุฑู ุฌุฐุงุจ.'
            },
            duja: {
                image: 'imgs/duja.jpg',
                name: 'ุฏูุฌู',
                latinName: 'duja',
                gender: 'male',
                notes: 'ูุจูุฐ โ ุจุฑุบููุช โ ูุงููุฏุฑ โ ูุงููููุง โ ูุณุชูุงุก โ ุจุงุชุดููู',
                description: 'ูููู ุบุงููุ ุฏุงูุฆ ูุญุณูุ ุจุทุงุจุน ูุงุฎุฑ ููุฎููู.'
            },
            wahj: {
                image: 'imgs/wahj.jpg',
                name: 'ููููุฌ',
                latinName: 'wahj',
                gender: 'male',
                notes: 'ุชูุงุญ โ ูุงููุฏุฑ โ ุบุงุฑุฏูููุง โ ูุงุณููู โ ูุงููููุง โ ููู โ ุฎุดุจ ุตูุฏู โ ุจุงุชุดููู',
                description: 'ูุถูุก ูุฏุงูุฆุ ุฃููู ููุชูุงุฒูุ ูุฌูุน ุจูู ุงููุนููุฉ ูุงูุฌุงุฐุจูุฉ.'
            },
            ghazal: {
                image: 'imgs/gazal.jpg',
                name: 'ุบูุฒูู',
                latinName: 'ghazal',
                gender: 'female',
                notes: 'ุฎูุฎ โ ููุฏูุฑูู โ ุฒููุฑ ุจูุถุงุก โ ุฃูุฑููุฏ ุฒูุฑู โ ุชูุช โ ูุณู',
                description: 'ุฃูุซูู ูุงุนูุ ุญูู ูููุนุดุ ุฑููุงูุณู ูุฌุฐุงุจ.'
            },
            ghuroor: {
                image: 'imgs/ghurur.jpg',
                name: 'ุบูุฑูุฑ',
                latinName: 'ghuroor',
                gender: 'female',
                notes: 'ุฒูุฑ ุงูุจุฑุชูุงู โ ุจุฑุบููุช โ ูุงุณููู โ ูุงููููุง โ ูุณู',
                description: 'ูุงุฎุฑ ูุฃูููุ ูุงุนู ูุญุณูุ ูุนูุณ ุงูุซูุฉ ูุงูุชูููุฒ.'
            },
            hayam: {
                image: 'imgs/heyam.jpg',
                name: 'ููููุงู',
                latinName: 'hayam',
                gender: 'female',
                notes: 'ูุดูุด ุฃุณูุฏ โ ููุซุฑู โ ุฒููุฑ ุจูุถุงุก โ ุณูุณู โ ุชูููุง โ ูุงููููุง',
                description: 'ุฑููุงูุณู ุฏุงูุฆุ ูุงุนู ูุนูููุ ุฃูุซูู ููุฎููู.'
            },
            hamsah: {
                image: 'imgs/hamsah.jpg', //!
                name: 'ููููุณูุฉ',
                latinName: 'hamsah',
                gender: 'female',
                notes: 'ุฒููุฑ ุงููุงุฑูุฌ โ ูุงููุฏุฑ โ ุฒููุฑ ุจูุถุงุก โ ุนูุจุฑ ุฃุจูุถ โ ูุณู',
                description: 'ูุงุฏุฆ ููููุ ุฃูุซูู ุฑุงููุ ูุงุนู ูููุณุฉ ุฏุงูุฆุฉ.'
            },
            waad: {
                image: 'imgs/waad.jpg',
                name: 'ููุนูุฏ',
                latinName: 'waad',
                gender: 'female',
                notes: 'ุฎูุฎ โ ุชูุช โ ุฒูุจู โ ุฎุดุจ ุตูุฏู โ ูุณู',
                description: 'ูุงุนู ููุดุฑูุ ุฑููุงูุณู ูุฃูููุ ุฅุญุณุงุณ ุจุงูุฏูุก ูุงูููุงุก.'
            },
            suha: {
                image: 'imgs/suha.jpg',
                name: 'ุณููู',
                latinName: 'suha',
                gender: 'female',
                notes: 'ูุฑูุฒ โ ุชูุช ุฃุญูุฑ โ ุชูุช ุฃุณูุฏ โ ูุฑุฒ โ ุนูุจ ุฃุณูุฏ โ ููููู',
                description: 'ูุฑูุชู ูุดุฑูุ ุญููู ูุฌุฐุงุจุ ูุฑุญ ูุฃูุซูู ุจููุณุฉ ููููุฉ.'
            }
        };

        function includesAny(text, keywords) {
            return keywords.some(kw => text.includes(kw));
        }

        function extractTags(perfume) {
            const text = `${perfume.notes} ${perfume.description}`.toLowerCase();
            const tags = new Set();

            if (includesAny(text, ['ุนูุฏ', 'ุฎุดุจ'])) tags.add('oud');
            if (includesAny(text, ['ุฎุดุจ', 'ุตูุฏู'])) tags.add('woody');
            if (includesAny(text, ['ุนูุจุฑ'])) tags.add('amber');
            if (includesAny(text, ['ูุณู'])) tags.add('musk');
            if (includesAny(text, ['ูุงููููุง', 'ูุฑุงููู', 'ุนุณู', 'ุชูููุง', 'ุญูู'])) tags.add('sweet');
            if (includesAny(text, ['ุญูุถูุงุช', 'ููููู', 'ููุฏุฑูู', 'ุจุฑุบููุช', 'ุชูุงุญ', 'ุฃูุงูุงุณ', 'ููุนุด'])) tags.add('fresh');
            if (includesAny(text, ['ูุฑุฏ', 'ุฒููุฑ', 'ูุงุณููู', 'ุบุงุฑุฏูููุง', 'ุฃูุฑููุฏ', 'ุฒูุฑ'])) tags.add('floral');
            if (includesAny(text, ['ูููู', 'ูุฑูุฉ', 'ููู', 'ุฒุนูุฑุงู', 'ุชูุงุจู', 'ุญุงุฑ'])) tags.add('spicy');
            if (includesAny(text, ['ุจุฎูุฑ', 'ุฏุฎุงูู', 'ุชุจุบ'])) tags.add('smoky');
            if (includesAny(text, ['ุฎูุฎ', 'ุชูุช', 'ูุฑูุฒ', 'ููุซุฑู', 'ูุฑุฒ', 'ุนูุจ', 'ูุฑูุชู', 'ููุงูู'])) tags.add('fruity');

            if (includesAny(text, ['ููู', 'ุญุงุฏ', 'ุฌุฑูุก', 'ูุดุชุนู'])) tags.add('strong');
            if (includesAny(text, ['ูุงุนู', 'ูุฑูุญ', 'ูุงุฏุฆ'])) tags.add('soft');
            if (includesAny(text, ['ูุชูุงุฒู', 'ูุชุฒู'])) tags.add('balanced');

            if (includesAny(text, ['ูุฎู', 'ูููุจ', 'ููุงุฑ', 'ููุจุฉ', 'ุฑุงูู', 'ุฃููู', 'ุชูููุฒ', 'ุฑุณูู'])) tags.add('formal');
            if (includesAny(text, ['ุนุตุฑู', 'ุญุฏูุซ', 'ูุดุฑู'])) tags.add('modern');
            if (includesAny(text, ['ููุงุณููู', 'ุฃูุงูุฉ'])) tags.add('classic');
            if (includesAny(text, ['ุบุงูุถ', 'ูุธูู', 'ูููู', 'ุฌุฐุงุจ'])) tags.add('mysterious');
            if (includesAny(text, ['ุฑููุงูุณู'])) tags.add('romantic');

            return tags;
        }

        function scorePerfume(perfumeTags, desiredTags) {
            const weights = {
                note: 4,
                occasion: 2,
                strength: 2,
                style: 2
            };

            let score = 0;

            desiredTags.forEach(item => {
                if (perfumeTags.has(item.tag)) {
                    score += weights[item.kind] ?? 1;
                }
            });

            return score;
        }

        // Step navigation
        let currentStep = 1;
        const totalSteps = 6;

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${currentStep} / ${totalSteps}`;
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.style.display = 'none';
            });
            
            const targetStep = document.querySelector(`[data-step="${stepNumber}"]`);
            if (targetStep) {
                targetStep.style.display = 'block';
            }

            const prevBtn = document.getElementById('prevBtn');
            if (stepNumber > 1) {
                prevBtn.style.display = 'block';
            } else {
                prevBtn.style.display = 'none';
            }

            currentStep = stepNumber;
            updateProgress();
        }

        // Auto-advance on selection
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', function() {
                setTimeout(() => {
                    if (currentStep < totalSteps) {
                        showStep(currentStep + 1);
                    } else if (currentStep === totalSteps) {
                        // Last step - show results
                        calculateAndShowResult();
                    }
                }, 300);
            });
        });

        // Previous button
        document.getElementById('prevBtn').addEventListener('click', function() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        });

        function calculateAndShowResult() {
            const formData = new FormData(document.getElementById('quizForm'));
            const gender = formData.get('gender');
            const usage = formData.get('usage');
            const strength = formData.get('strength');
            const style = formData.get('style');
            const note = formData.get('note');

            const desiredTags = [];

            if (note === 'oud') {
                desiredTags.push({ kind: 'note', tag: 'oud' });
                desiredTags.push({ kind: 'note', tag: 'woody' });
            }
            if (note === 'floral') desiredTags.push({ kind: 'note', tag: 'floral' });
            if (note === 'sweet') desiredTags.push({ kind: 'note', tag: 'sweet' });
            if (note === 'fresh') desiredTags.push({ kind: 'note', tag: 'fresh' });
            if (note === 'spicy') desiredTags.push({ kind: 'note', tag: 'spicy' });

            if (usage === 'daily') desiredTags.push({ kind: 'occasion', tag: 'fresh' });
            if (usage === 'formal') desiredTags.push({ kind: 'occasion', tag: 'formal' });
            if (usage === 'night') {
                desiredTags.push({ kind: 'occasion', tag: 'mysterious' });
                desiredTags.push({ kind: 'occasion', tag: 'romantic' });
            }

            if (strength === 'soft') desiredTags.push({ kind: 'strength', tag: 'soft' });
            if (strength === 'balanced') desiredTags.push({ kind: 'strength', tag: 'balanced' });
            if (strength === 'strong') desiredTags.push({ kind: 'strength', tag: 'strong' });

            if (style === 'classic') desiredTags.push({ kind: 'style', tag: 'classic' });
            if (style === 'modern') desiredTags.push({ kind: 'style', tag: 'modern' });
            if (style === 'mysterious') desiredTags.push({ kind: 'style', tag: 'mysterious' });

            const perfumeEntries = Object.entries(perfumes);
            const candidates = perfumeEntries.filter(([, perfume]) => perfume.gender === gender);
            const pool = candidates.length > 0 ? candidates : perfumeEntries;

            let bestKey = pool[0][0];
            let bestScore = -1;

            pool.forEach(([key, perfume]) => {
                const tags = extractTags(perfume);
                const score = scorePerfume(tags, desiredTags);
                if (score > bestScore) {
                    bestScore = score;
                    bestKey = key;
                }
            });

            const perfume = perfumes[bestKey];

            // Detect contradictions in user choices
            const contradictions = [];
            
            // Daily usage + Strong/Powerful notes (oud, spicy)
            if (usage === 'daily' && (note === 'oud' || note === 'spicy')) {
                contradictions.push('ุงูุงุณุชุฎุฏุงู ุงููููู ูุง ูุชูุงุณุจ ุนุงุฏุฉ ูุน ุงูุนูุฏ ุฃู ุงูุชูุงุจู ุงููููุฉ');
            }
            
            // Soft strength + Oud/Spicy notes
            if (strength === 'soft' && (note === 'oud' || note === 'spicy')) {
                contradictions.push('ุงูุนุทุฑ ุงููุงุนู ูุง ูุชูุงุดู ูุน ููุชุงุช ุงูุนูุฏ ุฃู ุงูุชูุงุจู ุงูุญุงุฏุฉ');
            }
            
            // Strong strength + Fresh/Floral notes
            if (strength === 'strong' && (note === 'fresh' || note === 'floral')) {
                contradictions.push('ุงูุนุทุฑ ุงูููู ูุงููุงูุช ูุง ูุชูุงุณุจ ุนุงุฏุฉ ูุน ุงูุญูุถูุงุช ุงูููุนุดุฉ ุฃู ุงูุฒููุฑ ุงููุงุนูุฉ');
            }
            
            // Formal occasions + Fresh notes
            if (usage === 'formal' && note === 'fresh') {
                contradictions.push('ุงูููุงุณุจุงุช ุงูุฑุณููุฉ ุชุชุทูุจ ุนุงุฏุฉ ุนุทูุฑูุง ุฃุนูู ูู ุงูุญูุถูุงุช ุงูููุนุดุฉ');
            }
            
            // Night usage + Fresh notes
            if (usage === 'night' && note === 'fresh') {
                contradictions.push('ุงูุงุณุชุฎุฏุงู ุงููุณุงุฆู ูุชุทูุจ ุนุงุฏุฉ ุนุทูุฑูุง ุฃูุซุฑ ุฏูุฆูุง ูู ุงูุญูุถูุงุช');
            }
            
            // Classic style + Fresh notes
            if (style === 'classic' && note === 'fresh') {
                contradictions.push('ุงูุทุงุจุน ุงูููุงุณููู ุงูุฃููู ูุง ูุชูุงุดู ุนุงุฏุฉ ูุน ุงูููุชุงุช ุงูููุนุดุฉ ุงูุฎูููุฉ');
            }
            
            // Modern style + Oud
            if (style === 'modern' && note === 'oud') {
                contradictions.push('ุงูุทุงุจุน ุงูุนุตุฑู ุงููุถูุก ูุง ูุชูุงุณุจ ุนุงุฏุฉ ูุน ุงูุนูุฏ ุงูุชูููุฏู');
            }

            document.getElementById('plantImage').src = perfume.image;
            document.getElementById('plantImage').alt = perfume.name;
            document.getElementById('plantName').textContent = perfume.name;
            
            // Build description with contradiction notice if needed
            let descriptionHTML = `<strong>ุงูููุชุงุช:</strong> ${perfume.notes}<br><br>${perfume.description}`;
            
            if (contradictions.length > 0) {
                const contradictionText = contradictions.join('ุ ');
                descriptionHTML = `<div class="contradiction-notice">
                    <strong>ููุงุญุธุฉ:</strong> ${contradictionText}ุ ููู ูุฐุง ุฃูุถู ุฎูุงุฑ ูุชุงุญ ุจูุงุกู ุนูู ุงุฎุชูุงุฑุงุชู.
                </div><br>` + descriptionHTML;
            }
            
            document.getElementById('plantDescription').innerHTML = descriptionHTML;

            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultContainer').style.display = 'block';

            window.scrollTo({ top: 0 });
        }

        // Form submission handler
        document.getElementById('quizForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Calculate result first
            calculateAndShowResult();
            
            // Submit data to PHP backend
            const formData = new FormData(this);
            
            fetch('index.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Quiz data saved successfully');
                }
            })
            .catch(error => {
                console.error('Error saving quiz data:', error);
            });
        });

        document.getElementById('resetButton').addEventListener('click', function() {
            document.getElementById('quizForm').reset();
            currentStep = 1;
            showStep(1);
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('resultContainer').style.display = 'none';
            window.scrollTo({ top: 0 });
        });

        // Initialize
        showStep(1);
    </script>
</body>
</html>
